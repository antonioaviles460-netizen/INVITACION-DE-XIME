<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>La Alegría de Mis XV - Invitación</title>
    <link rel="stylesheet" href="CSS/style.css">
    
    
    <!-- 
      FUENTES MEJORADAS: 
      - Dancing Script (para el nombre "Ximena")
      - Cormorant Garamond (para títulos elegantes)
      - Inter (para el cuerpo del texto legible)
    -->
    <link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:wght@400;700&family=Dancing+Script:wght@700&family=Inter:wght@300;400;700&display=swap" rel="stylesheet">
    
    <!-- Iconos de Font Awesome para los detalles -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* ========================================
         PALETA DE COLOR SOFISTICADA (MEJORADA)
         ========================================
        */
        :root {
            --color-primary: #B8860B;     /* Dorado Fuerte (Goldenrod) - Acentos */
            --color-secondary: #D4AF37;   /* Dorado Metálico (Classic Gold) - Brillos / Hover */
            --color-dark: #2B2A27;        /* Carbón Cálido (Warm Charcoal) - Fondos oscuros */
            --color-light: #FDFDFB;       /* Blanco Crema (Creamy White) - Texto sobre oscuro */
            --color-bg: #FCFBF4;          /* Fondo Marfil (Ivory Background) - Fondo principal */
            --color-text-dark: #4E4A40;   /* Texto Oscuro Suave (Soft Dark Text) - Texto principal */
            
            /* FUENTES */
            --font-family-title: 'Cormorant Garamond', serif; /* Títulos elegantes */
            --font-family-script: 'Dancing Script', cursive;  /* Nombre principal */
            --font-family-body: 'Inter', sans-serif;          /* Cuerpo legible */
        }

        /* ========================================
         ESTILOS BASE MEJORADOS
         ========================================
        */
        body {
            background-color: var(--color-bg); /* Fondo Marfil */
            color: var(--color-text-dark); /* Texto oscuro suave */
            font-family: var(--font-family-body);
            scroll-behavior: smooth;
            margin: 0;
            line-height: 1.7; /* Más espaciado para mejor lectura */
            font-weight: 300; /* Texto de cuerpo más ligero */
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        h1, h2, h3 {
            font-weight: 700;
        }

        /* Utilidades de Diseño (Responsive y Centrado) */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 15px;
        }
        .text-center { text-align: center; }
        .py-20 { padding-top: 5rem; padding-bottom: 5rem; }
        .mb-10 { margin-bottom: 2.5rem; }
        .rounded-xl { border-radius: 0.75rem; }
        .card {
            background-color: var(--color-light); /* Blanco crema */
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08); 
            border-radius: 12px;
            border-top: 5px solid var(--color-primary); /* Detalle dorado */
        }
        .card p {
            font-size: 1.1rem;
            line-height: 1.8;
            color: #5c5850; /* Texto ligeramente más oscuro para contraste en tarjeta */
        }

        /* ========================================
         PANTALLA DE BIENVENIDA (NUEVAS FUENTES)
         ========================================
        */
        #welcome-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--color-dark); /* Carbón cálido */
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            opacity: 1;
            transition: opacity 1s ease-in-out;
        }
        #welcome-screen.hidden {
            opacity: 0;
            visibility: hidden;
            pointer-events: none;
        }
        .welcome-content { text-align: center; }
        
        /* FUENTE SCRIPT para el nombre */
        .welcome-content h1 {
            font-family: var(--font-family-script);
            font-size: clamp(3rem, 8vw, 6rem);
            color: var(--color-primary);
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            margin: 0;
        }
        
        /* FUENTE GARAMOND para el subtítulo */
        .welcome-content p {
            font-family: var(--font-family-title);
            font-size: clamp(1.2rem, 3vw, 1.8rem);
            color: var(--color-light);
            margin-bottom: 25px;
            letter-spacing: 2px;
        }
        
        /* ========================================
         BOTONES DINÁMICOS (CON BRILLO)
         ========================================
        */
        @keyframes shine {
            0% { left: -100%; }
            50% { left: 100%; }
            100% { left: 100%; }
        }

        .animated-button {
            padding: 15px 30px;
            margin-top: 20px;
            background-color: var(--color-primary);
            color: var(--color-dark);
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 700;
            font-family: var(--font-family-body);
            font-size: 1rem;
            box-shadow: 0 4px 15px rgba(184, 134, 11, 0.5);
            transition: transform 0.3s, box-shadow 0.3s, background-color 0.3s;
            position: relative;
            overflow: hidden;
        }
        
        /* Efecto de brillo */
        .animated-button::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 75%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.4), transparent);
            transform: skewX(-25deg);
            animation: shine 5s infinite linear; /* Animación de brillo */
        }
        
        .animated-button:hover {
            background-color: var(--color-secondary);
            box-shadow: 0 6px 20px rgba(212, 175, 55, 0.7);
            transform: translateY(-2px);
        }
        .animated-button:active {
            transform: scale(0.95);
        }
        
        /* ========================================
         HERO SECTION (CON EFECTO PARALLAX)
         ========================================
        */
        .hero {
            /* Imagen de fondo */
            background: linear-gradient(180deg, rgba(43, 42, 39, 0.8), rgba(43, 42, 39, 1)), 
                          url(https://placehold.co/1200x800/2B2A27/D4AF37?text=Foto+Elegante) center center / cover no-repeat;
            
            /* EFECTO PARALLAX */
            background-attachment: fixed; 
            
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: flex-end;
            align-items: center;
            padding-bottom: 50px;
            color: var(--color-light); 
            position: relative;
        }

        .hero-text {
            text-align: center;
            margin-bottom: 40px;
        }
        .hero-text h1 { 
            font-family: var(--font-family-script);
            font-size: clamp(3rem, 7vw, 6rem); 
            color: var(--color-secondary); 
            text-shadow: 0 0 10px rgba(212, 175, 55, 0.5);
            margin: 0;
        }
        .hero-text h2 { 
            font-family: var(--font-family-title);
            font-size: clamp(1.2rem, 3vw, 1.8rem); 
            color: var(--color-light); 
            font-weight: 400;
            letter-spacing: 2px;
            margin-top: 0.5rem;
        }

        /* ========================================
         CUENTA REGRESIVA (EFECTO "GLASS")
         ========================================
        */
        #countdown {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
            flex-wrap: wrap; /* Para mejor responsividad */
        }
        #countdown div {
            /* EFECTO GLASS */
            background-color: rgba(43, 42, 39, 0.5); /* Negro carbón semitransparente */
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
            
            border: 1px solid rgba(212, 175, 55, 0.2); /* Borde dorado sutil */
            border-radius: 12px;
            
            flex: 1;
            padding: 15px 5px;
            min-width: 70px; /* Ancho mínimo */
            max-width: 100px; /* Ancho máximo */
            color: var(--color-light); 
            text-align: center;
            font-size: 0.8rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
        }
        #countdown div span:first-child {
            color: var(--color-secondary); 
            font-weight: 700;
            font-size: 2.2rem;
            font-family: var(--font-family-title); /* Fuente elegante para números */
            display: block;
            line-height: 1;
            margin-bottom: 5px;
        }
        #countdown div span:last-child {
            font-family: var(--font-family-body);
            font-weight: 300;
            letter-spacing: 1px;
            text-transform: uppercase;
        }

        /* ========================================
         TÍTULOS Y DETALLES DE SECCIÓN
         ========================================
        */
        .section-title {
            font-family: var(--font-family-title);
            font-weight: 700;
            color: var(--color-primary); 
            font-size: clamp(2rem, 4vw, 3rem); 
            margin-bottom: 30px;
            border-bottom: 2px solid var(--color-secondary);
            padding-bottom: 10px;
            display: inline-block;
            letter-spacing: 1px;
        }
        
        .detail-item {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px;
        }
        .detail-item i {
            color: var(--color-primary);
            font-size: 1.5rem;
            margin-right: 15px;
            min-width: 30px;
            margin-top: 5px;
        }
        .detail-item h3 {
            font-family: var(--font-family-title);
            color: var(--color-text-dark);
            margin: 0;
            font-size: 1.5rem; /* Título de detalle más grande */
        }
        .detail-item p {
            margin: 5px 0 0 0;
            font-size: 0.95rem;
            color: #555;
            line-height: 1.5;
        }
        .details-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
        }
        @media (min-width: 768px) {
            .details-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
        
        /* Mapa Embed */
        .map-embed-container {
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1); 
            border-radius: 12px;
            position: relative;
            width: 100%;
            padding-bottom: 56.25%; 
            margin-top: 15px;
            overflow: hidden;
            border: 2px solid var(--color-primary); /* Borde elegante */
        }
        .map-embed-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: 0;
        }

        /* ========================================
         MODAL Y FORMULARIO (OSCURO Y ELEGANTE)
         ========================================
        */
        .modal {
            display: none;
            position: fixed;
            z-index: 2000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.85);
            backdrop-filter: blur(8px);
            padding-top: 50px;
        }
        .modal-content {
            background-color: var(--color-dark); 
            margin: 10% auto;
            padding: 30px;
            border-radius: 12px;
            width: 90%;
            max-width: 550px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.8);
            animation: fadeInModal 0.3s;
            border-top: 5px solid var(--color-primary); /* Consistente con tarjetas */
            color: var(--color-light); 
        }
        .close-button {
            color: var(--color-light);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
            transition: color 0.2s;
        }
        .close-button:hover {
            color: var(--color-primary); 
        }

        .modal label {
            display: block;
            margin-top: 15px;
            margin-bottom: 8px;
            font-weight: 400;
            color: var(--color-primary); /* Etiquetas en dorado */
            font-family: var(--font-family-body);
        }
        .modal input[type="text"], .modal input[type="number"], .modal select {
            width: 100%;
            box-sizing: border-box; 
            padding: 12px;
            border: 1px solid #4B5563;
            border-radius: 6px;
            background-color: #2D3033; 
            color: var(--color-light);
            outline: none;
            transition: border-color 0.2s, box-shadow 0.2s;
            appearance: none;
            font-family: var(--font-family-body);
        }
        .modal input:focus, .modal select:focus {
            border-color: var(--color-secondary);
            box-shadow: 0 0 5px rgba(212, 175, 55, 0.5);
        }

        /* --- ANIMACIÓN DE CONFIRMACIÓN (CSS PURO) --- */
        
        /* Botón de envío del formulario (hereda el estilo animado) */
        .rsvp-form-button {
            display: block;
            width: 100%; 
            box-sizing: border-box; 
            margin-top: 30px;
            padding: 18px; 
            font-size: 1.25rem; 
            font-weight: bold;
            background: linear-gradient(145deg, var(--color-primary), var(--color-secondary)); 
        }

        .rsvp-form-button.confirmed {
            width: 55px;
            height: 55px;
            padding: 0;
            line-height: 55px; 
            background: var(--color-secondary); 
            color: var(--color-dark); 
            border-radius: 50%;
            transform: rotate(360deg);
            box-shadow: 0 0 20px var(--color-secondary);
            font-size: 0; 
            transition: all 0.5s ease-in-out;
        }
        .rsvp-form-button.confirmed::before {
            display: none; /* Oculta el brillo durante la confirmación */
        }
        
        .rsvp-form-button.confirmed::after {
            content: '✓'; 
            font-size: 2.2rem; 
            font-weight: bold;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) scale(0);
            animation: check-appear 0.4s 0.3s forwards;
            color: var(--color-dark); 
        }

        /* Keyframes */
        @keyframes check-appear {
            0% { transform: translate(-50%, -50%) scale(0); opacity: 0; }
            100% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
        }
        @keyframes fadeInModal {
            from { opacity: 0; transform: translateY(-50px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* ========================================
         ANIMACIONES DE SCROLL
         ========================================
        */
        .animate-on-scroll {
            opacity: 0;
            transform: translateY(20px);
            transition: opacity 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94), transform 0.9s cubic-bezier(0.25, 0.46, 0.45, 0.94);
        }
        .animate-on-scroll.visible {
            opacity: 1;
            transform: translateY(0);
        }
        #main-content {
            opacity: 0;
            transition: opacity 1s ease-in-out;
        }
    </style>
</head>
<body>

    <!-- Pantalla de Bienvenida Dinámica -->
    <div id="welcome-screen">
        <div class="welcome-content animate-on-scroll visible">
            <!-- Título con Fuente Script -->
            <h1>Ximena</h1>
            <!-- Subtítulo con Fuente Serif -->
            <p>Mis Quince Años</p>
            <button id="enter-button" class="animated-button">Presiona para Entrar</button>
        </div>
    </div>

    <!-- Contenido Principal -->
    <main id="main-content">
        
        <!-- Hero Section con Cuenta Regresiva -->
        <section class="hero">
            <div class="hero-text">
                <h1 class="animate-on-scroll">Ximena</h1>
                <h2 class="animate-on-scroll">La Alegría de Mis XV</h2>
            </div>
            <div id="countdown" class="animate-on-scroll">
                <!-- Los spans serán llenados por JavaScript -->
                <div><span id="days">00</span><span>Días</span></div>
                <div><span id="hours">00</span><span>Horas</span></div>
                <div><span id="minutes">00</span><span>Minutos</span></div>
                <div><span id="seconds">00</span><span>Segundos</span></div>
            </div>
        </section>

        <div class="container py-20">
            
            <!-- Mensaje de Invitación -->
            <section id="invitation-message" class="text-center animate-on-scroll">
                <h2 class="section-title">Mi Mayor Deseo</h2>
                <div class="card">
                    <p>
                        Con la bendición de Dios y el amor de mis padres, ha llegado el día de celebrar mis quince años. 
                        Quiero compartir este momento tan especial con las personas que más amo, tú eres una de ellas.
                        Te espero con el corazón lleno de ilusión para celebrar juntos esta nueva etapa.
                    </p>
                </div>
            </section>

            <!-- Padres y Padrinos -->
            <section id="family" class="text-center animate-on-scroll">
                <h2 class="section-title">Familia y Bendición</h2>
                <div class="details-grid card">
                    <div class="detail-item text-center" style="display: block;">
                        <i class="fas fa-venus-mars"></i>
                        <h3>Nuestros Padres</h3>
                        <p>
                            <strong>Padre:</strong> [Nombre del Padre]<br>
                            <strong>Madre:</strong> Maria Yuriria Avila Jimenez
                        </p>
                    </div>
                    <div class="detail-item text-center" style="display: block;">
                        <i class="fas fa-hand-holding-heart"></i>
                        <h3>Padrinos</h3>
                        <p>
                            [Nombre del Padrino] y [Nombre de la Madrina]
                        </p>
                    </div>
                </div>
            </section>

            <!-- Itinerario -->
            <section id="itinerary" class="animate-on-scroll">
                <h2 class="section-title text-center">Itinerario y Ubicación</h2>
                <div class="details-grid">
                    <!-- Evento 1: Misa -->
                    <div class="card">
                        <div class="detail-item">
                            <i class="fas fa-church"></i>
                            <div>
                                <h3>Misa de Acción de Gracias</h3>
                                <p><strong>Iglesia:</strong> Parroquia de San Judas Tadeo</p>
                                <p><strong>Fecha:</strong> Sábado 12 de Febrero de 2026</p>
                                <p><strong>Hora:</strong> 6:00 PM</p>
                            </div>
                        </div>
                    </div>
                    <!-- Evento 2: Recepción -->
                    <div class="card">
                        <div class="detail-item">
                            <i class="fas fa-champagne-glasses"></i>
                            <div>
                                <h3>Recepción (Gran Fiesta)</h3>
                                <p><strong>Lugar:</strong> Salón de Eventos "El Dorado"</p>
                                <p><strong>Hora:</strong> 8:00 PM</p>
                                <p><strong>Vestimenta:</strong> Formal de Noche</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Ubicación del Evento (Mapa) -->
            <section id="location" class="animate-on-scroll mb-10">
                <h2 class="section-title text-center">¿Cómo Llegar?</h2>
                <p class="text-center" style="margin-bottom: 20px; font-size: 1.1rem;">
                    Te compartimos el mapa para la Recepción en "El Dorado".
                </p>
                <div class="map-embed-container">
                    <!-- Mapa de ejemplo, reemplaza con tu propio iframe de Google Maps -->
                    <iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3401.760144574944!2d-106.4418659!3d31.7588107!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x86e75a6c0c28269d%3A0x6b87612f00d235c3!2sJu%C3%A1rez%2C%20Chih.!5e0!3m2!1ses-419!2smx!4v1633513200000!5m2!1ses-419!2smx" allowfullscreen="" loading="lazy"></iframe>
                </div>
            </section>

            <!-- Botón de Confirmación de Asistencia (RSVP) -->
            <section id="rsvp-section" class="text-center animate-on-scroll py-20">
                <h2 class="section-title">Confirma tu Asistencia</h2>
                <p style="margin-bottom: 30px; font-size: 1.1rem;">
                    Te pedimos confirmar tu asistencia antes del [Fecha Límite] para organizar tu lugar. ¡Gracias!
                </p>
                <button class="animated-button" onclick="document.getElementById('rsvpModal').style.display='block';">
                    Confirmar Asistencia
                </button>
            </section>

        </div>
    </main>

    <!-- Modal de RSVP -->
    <div id="rsvpModal" class="modal">
        <div class="modal-content">
            <span class="close-button" onclick="document.getElementById('rsvpModal').style.display='none'">&times;</span>
            <h2 style="font-family: var(--font-family-title); color: var(--color-primary); margin-top: 0; font-size: 2.2rem;">Confirmación</h2>
            <form id="rsvpForm">
                <label for="guestName">Tu Nombre Completo:</label>
                <input type="text" id="guestName" required placeholder="Ej: Diana Pérez">
                
                <label for="attending">¿Asistirás al Evento?</label>
                <select id="attending" required>
                    <option value="" disabled selected>Selecciona una opción</option>
                    <option value="si">¡Sí, con gusto!</option>
                    <option value="no">No podré asistir</option>
                </select>

                <label for="guests">¿Cuántos adultos confirmas (contándote a ti)?</label>
                <input type="number" id="guests" min="1" max="5" value="1" required>

                <button type="submit" class="animated-button rsvp-form-button">Enviar Confirmación</button>

                <p id="rsvpMessage" style="text-align: center; margin-top: 20px; color: var(--color-light); display: none;"></p>
            </form>
        </div>
    </div>

    <script type="module">
        // --- 1. Inicialización de Firebase y Autenticación ---
        // Se asume que las variables __app_id, __firebase_config y __initial_auth_token
        // se proveen en el entorno de ejecución.

        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, setDoc, collection, getDoc, setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // Global variables provided by the environment
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfigStr = typeof __firebase_config !== 'undefined' ? __firebase_config : null;
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;

        let app, db, auth, userId = null;
        let isAuthReady = false;

        if (firebaseConfigStr) {
            try {
                const firebaseConfig = JSON.parse(firebaseConfigStr);
                app = initializeApp(firebaseConfig);
                db = getFirestore(app);
                auth = getAuth(app);
                // setLogLevel('debug'); // Descomentar para logs detallados de Firestore

                onAuthStateChanged(auth, async (user) => {
                    if (user) {
                        userId = user.uid;
                    } else {
                        try {
                            if (initialAuthToken) {
                                await signInWithCustomToken(auth, initialAuthToken);
                            } else {
                                await signInAnonymously(auth);
                            }
                            userId = auth.currentUser?.uid || 'anonymous-user';
                        } catch (e) {
                            console.error("Firebase Auth Error:", e);
                            userId = 'error-user';
                        }
                    }
                    isAuthReady = true;
                    // console.log("Firebase Auth Ready. User ID:", userId);
                    
                    if (userId && userId !== 'error-user') {
                        loadRsvpData();
                    }
                });

            } catch (e) {
                console.error("Error al inicializar Firebase:", e);
                isAuthReady = true; 
            }
        } else {
             console.error("Firebase config no disponible.");
             isAuthReady = true; 
        }

        // --- 2. Funciones de Base de Datos (Firestore) ---

        function getRsvpCollectionRef() {
            if (!db || !userId || userId === 'error-user') {
                // console.error("Firestore DB o User ID no están listos.");
                return null;
            }
            return collection(db, 'artifacts', appId, 'users', userId, 'rsvp_confirmations');
        }

        async function loadRsvpData() {
            const rsvpCollectionRef = getRsvpCollectionRef();
            if (!rsvpCollectionRef) { return; }

            try {
                const rsvpDocRef = doc(rsvpCollectionRef, userId);
                const docSnap = await getDoc(rsvpDocRef);

                if (docSnap.exists()) {
                    const data = docSnap.data();
                    document.getElementById('guestName').value = data.guestName || '';
                    document.getElementById('attending').value = data.attending || 'si';
                    document.getElementById('guests').value = data.guests || 1;
                    
                    const messageElement = document.getElementById('rsvpMessage');
                    messageElement.textContent = "Tu confirmación anterior ha sido cargada.";
                    messageElement.style.display = 'block';
                }
            } catch (e) {
                console.error("Error al cargar RSVP:", e);
            }
        }


        // --- 3. Lógica del Formulario y Dinamismo ---

        document.getElementById('enter-button').addEventListener('click', () => {
            document.getElementById('welcome-screen').classList.add('hidden');
            document.getElementById('main-content').style.opacity = '1';
        });

        document.addEventListener('DOMContentLoaded', () => {
            // Fecha de la Misa (Año-Mes-DíaTHora:Minuto:Segundo)
            setupCountdown('2026-02-12T18:00:00'); 
            setupScrollAnimations();
        });

        function setupCountdown(targetDate) {
            const countdownDate = new Date(targetDate).getTime();
            const countdownEl = document.getElementById("countdown");
            if (!countdownEl) return;

            const x = setInterval(function() {
                const now = new Date().getTime();
                const distance = countdownDate - now;

                if (distance < 0) {
                    clearInterval(x);
                    countdownEl.innerHTML = "<h3 style='font-family: var(--font-family-script); color: var(--color-secondary); font-size: 2rem; margin: 0;'>¡Es Hoy! ¡A Celebrar!</h3>";
                    return;
                }

                const days = Math.floor(distance / (1000 * 60 * 60 * 24));
                const hours = Math.floor((distance % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((distance % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((distance % (1000 * 60)) / 1000);

                document.getElementById("days").textContent = String(days).padStart(2, '0');
                document.getElementById("hours").textContent = String(hours).padStart(2, '0');
                document.getElementById("minutes").textContent = String(minutes).padStart(2, '0');
                document.getElementById("seconds").textContent = String(seconds).padStart(2, '0');

            }, 1000);
        }

        function setupScrollAnimations() {
            const elements = document.querySelectorAll('.animate-on-scroll');
            
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        entry.target.classList.add('visible');
                    }
                });
            }, {
                threshold: 0.1 
            });

            elements.forEach(element => {
                observer.observe(element);
            });
        }

        document.getElementById('rsvpForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const button = e.submitter;
            const originalText = button.textContent;
            button.textContent = 'Guardando...';
            button.disabled = true;

            const rsvpMessage = document.getElementById('rsvpMessage');
            rsvpMessage.style.display = 'none';

            if (!isAuthReady || !userId || userId === 'error-user') {
                rsvpMessage.textContent = 'Error: La conexión con el servidor no está lista. Intenta de nuevo.';
                rsvpMessage.style.color = '#FF6B6B'; // Rojo error
                rsvpMessage.style.display = 'block';
                button.textContent = originalText;
                button.disabled = false;
                return;
            }

            const guestName = document.getElementById('guestName').value.trim();
            const attending = document.getElementById('attending').value;
            const guests = parseInt(document.getElementById('guests').value, 10);

            if (!guestName || !attending) {
                rsvpMessage.textContent = 'Por favor completa todos los campos.';
                rsvpMessage.style.color = 'var(--color-secondary)'; // Amarillo advertencia
                rsvpMessage.style.display = 'block';
                button.textContent = originalText;
                button.disabled = false;
                return;
            }

            const rsvpData = {
                guestName: guestName,
                attending: attending,
                guests: guests,
                timestamp: new Date().toISOString()
            };

            try {
                const rsvpCollectionRef = getRsvpCollectionRef();
                if (!rsvpCollectionRef) {
                    throw new Error("No se pudo obtener la referencia de la base de datos.");
                }
                
                const rsvpDocRef = doc(rsvpCollectionRef, userId); 
                
                await setDoc(rsvpDocRef, rsvpData, { merge: true }); 

                button.textContent = '';
                button.classList.add('confirmed');
                rsvpMessage.textContent = '¡Confirmación enviada con éxito!';
                rsvpMessage.style.color = 'var(--color-secondary)'; // Dorado éxito
                rsvpMessage.style.display = 'block';

                setTimeout(() => {
                    document.getElementById('rsvpModal').style.display = 'none';
                    button.classList.remove('confirmed');
                    button.textContent = originalText;
                    button.disabled = false;
                    rsvpMessage.style.display = 'none';
                }, 2000);


            } catch (error) {
                console.error("Error al guardar RSVP en Firestore:", error);
                rsvpMessage.textContent = 'Error al confirmar. Intenta de nuevo.';
                rsvpMessage.style.color = '#FF6B6B'; // Rojo error
                rsvpMessage.style.display = 'block';
                button.textContent = originalText;
                button.disabled = false;
            }
        });
        
    </script>
</body>
</html>